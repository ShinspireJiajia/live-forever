<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>編輯對保預約 - 陸府建設 CRM</title>
    
    <!-- Font Awesome 圖示 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CSS 樣式 -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/breadcrumb.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/forms.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/reservation-collateral-edit.css">
</head>
<body>
    <div class="app-container">
        <!-- 頂部導覽列 -->
        <div id="header-container"></div>

        <!-- 側邊欄選單 -->
        <div id="sidebar-container"></div>

        <!-- 主內容區域 -->
        <main class="main-content">
            <div class="breadcrumb">
                <a href="index.html" class="breadcrumb-item">
                    <i class="fa-solid fa-house"></i>
                    首頁
                </a>
                <span class="breadcrumb-separator">/</span>
                <a href="reservation-collateral.html" class="breadcrumb-item">對保預約</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-item active">編輯預約</span>
            </div>

            <div class="content-wrapper">
                <div class="page-header">
                    <h1 class="page-title">編輯對保預約</h1>
                </div>

                <div class="edit-container">
                    <form id="collateralEditForm">
                        <input type="hidden" id="collateralId">
                        
                        <!-- 基本資料區塊 -->
                        <div class="section-block">
                            <h3 class="section-title">基本資料</h3>
                            <div class="form-row">
                                <!-- 案場 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">案場</label>
                                    <select class="form-select" id="hProject" required>
                                        <option value="">請選擇案場</option>
                                        <option value="陸府原森">陸府原森</option>
                                        <option value="陸府觀微">陸府觀微</option>
                                        <option value="陸府植森">陸府植森</option>
                                    </select>
                                </div>
                                <!-- 戶別 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">戶別</label>
                                    <select class="form-select" id="hUnit" required disabled>
                                        <option value="">請先選擇案場</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <!-- 預約者姓名 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">預約者姓名</label>
                                    <input type="text" class="form-control" id="hMemberName" required placeholder="請輸入預約者姓名">
                                </div>
                                <!-- 手機 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">手機</label>
                                    <input type="tel" class="form-control" id="hPhone" required placeholder="請輸入手機號碼" pattern="09[0-9]{8}" title="請輸入有效的手機號碼，格式：09xxxxxxxx">
                                </div>
                            </div>

                            <div class="form-row">
                                <!-- 日期 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">日期</label>
                                    <input type="date" class="form-control" id="hDate" required>
                                </div>
                                <!-- 時段 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">時段</label>
                                    <select class="form-select" id="hTimeSlot" required>
                                        <option value="">請選擇時段</option>
                                        <option value="09:00-10:00">09:00-10:00</option>
                                        <option value="10:00-11:00">10:00-11:00</option>
                                        <option value="11:00-12:00">11:00-12:00</option>
                                        <option value="14:00-15:00">14:00-15:00</option>
                                        <option value="15:00-16:00">15:00-16:00</option>
                                        <option value="16:00-17:00">16:00-17:00</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <!-- 主責人員 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">主責人員</label>
                                    <select class="form-select" id="hInCharge" required>
                                        <option value="">請選擇主責人員</option>
                                        <option value="王大明">王大明</option>
                                        <option value="李小華">李小華</option>
                                        <option value="張志豪">張志豪</option>
                                        <option value="陳淑芬">陳淑芬</option>
                                    </select>
                                </div>
                            </div>
                            <!-- 備註 -->
                            <div class="form-group">
                                <label class="form-label">備註</label>
                                <textarea class="form-control" id="hRemark" rows="3" placeholder="請輸入備註（選填）"></textarea>
                            </div>
                        </div>

                        <!-- 貸款資訊區塊 -->
                        <div class="section-block">
                            <h3 class="section-title">貸款資訊</h3>
                            
                            <!-- 問卷結果顯示區塊 -->
                            <div class="questionnaire-result-block" id="questionnaireResultBlock" style="background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                                <h4 style="font-size: 1rem; font-weight: bold; margin-bottom: 12px; color: var(--color-gray-700);">
                                    <i class="fa-solid fa-clipboard-check" style="color: var(--color-info);"></i> 用戶問卷填寫結果
                                </h4>
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label class="form-label">貸款意願</label>
                                        <input type="text" class="form-control" id="qLoanIntent" readonly style="background-color: #fff;">
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label class="form-label">選擇銀行</label>
                                        <input type="text" class="form-control" id="qSelectedBank" readonly style="background-color: #fff;">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label class="form-label">預計貸款金額</label>
                                        <input type="text" class="form-control" id="qExpectedLoanAmount" readonly style="background-color: #fff;">
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label class="form-label">貸款用途</label>
                                        <input type="text" class="form-control" id="qLoanPurpose" readonly style="background-color: #fff;">
                                    </div>
                                </div>
                                <!-- 新增對保地址欄位 -->
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label class="form-label">
                                            <i class="fa-solid fa-location-dot" style="color: var(--color-danger); margin-right: 4px;"></i>
                                            對保地點
                                        </label>
                                        <input type="text" class="form-control" id="qCollateralLocation" readonly style="background-color: #fff;">
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label class="form-label">對保地址</label>
                                        <input type="text" class="form-control" id="qCollateralAddress" readonly style="background-color: #fff;">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label class="form-label">是否有其他貸款</label>
                                        <input type="text" class="form-control" id="qHasOtherLoans" readonly style="background-color: #fff;">
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label class="form-label">方便聯絡時間</label>
                                        <input type="text" class="form-control" id="qPreferredContactTime" readonly style="background-color: #fff;">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label class="form-label">產權登記方式</label>
                                        <input type="text" class="form-control" id="qPropertyRegistration" readonly style="background-color: #fff;">
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label class="form-label">登記人姓名</label>
                                        <input type="text" class="form-control" id="qRegistrationName" readonly style="background-color: #fff;">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-12">
                                        <label class="form-label">登記人身分證字號</label>
                                        <input type="text" class="form-control" id="qRegistrationId" readonly style="background-color: #fff;">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">其他備註</label>
                                    <textarea class="form-control" id="qOtherNotes" rows="2" readonly style="background-color: #fff;"></textarea>
                                </div>
                            </div>

                            <div class="form-row">
                                <!-- 銀行選項 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label">銀行選項</label>
                                    <select class="form-select" id="hBankOption">
                                        <option value="">請選擇銀行</option>
                                        <option value="台灣銀行">台灣銀行</option>
                                        <option value="土地銀行">土地銀行</option>
                                        <option value="中國信託">中國信託</option>
                                        <option value="玉山銀行">玉山銀行</option>
                                        <option value="台新銀行">台新銀行</option>
                                        <option value="國泰世華">國泰世華</option>
                                    </select>
                                    <div class="form-text" style="color: var(--color-gray-500); font-size: var(--font-size-xs); margin-top: 4px;">來源：用戶問卷選擇</div>
                                </div>
                                <!-- 預計貸款金額 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label">預計貸款金額</label>
                                    <div style="display: flex; align-items: center;">
                                        <input type="number" class="form-control" id="hLoanAmount" placeholder="請輸入金額" style="flex: 1; border-top-right-radius: 0; border-bottom-right-radius: 0;">
                                        <span style="padding: 0 12px; background-color: var(--color-gray-100); border: 1px solid var(--color-gray-300); border-left: 0; height: 38px; display: flex; align-items: center; border-top-right-radius: 4px; border-bottom-right-radius: 4px;">萬元</span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row" id="rowAgencyFeeDeadline">
                                <!-- 代辦費金額 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label">代辦費金額</label>
                                    <div style="display: flex; align-items: center;">
                                        <input type="number" class="form-control" id="hAgencyFee" placeholder="請輸入金額" readonly style="flex: 1; border-top-right-radius: 0; border-bottom-right-radius: 0; background-color: #f5f5f5;">
                                        <span style="padding: 0 12px; background-color: var(--color-gray-100); border: 1px solid var(--color-gray-300); border-left: 0; height: 38px; display: flex; align-items: center; border-top-right-radius: 4px; border-bottom-right-radius: 4px;">元</span>
                                    </div>
                                    <div class="form-text" style="color: var(--color-info); font-size: var(--font-size-xs); margin-top: 4px;">
                                        <i class="fa-solid fa-circle-info"></i> 來源：戶別預約條件設定
                                    </div>
                                </div>
                                <!-- 繳款期限 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label">繳款期限</label>
                                    <input type="date" class="form-control" id="hPaymentDeadline" readonly style="background-color: #f5f5f5;">
                                    <div class="form-text" style="color: var(--color-info); font-size: var(--font-size-xs); margin-top: 4px;">
                                        <i class="fa-solid fa-circle-info"></i> 來源：戶別預約條件設定
                                    </div>
                                </div>
                            </div>
                            <div class="form-row" id="rowPaymentAccount">
                                <!-- 繳款帳號 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label">繳款帳號</label>
                                    <input type="text" class="form-control" id="hPaymentAccount" placeholder="請輸入繳款帳號" readonly style="background-color: #f5f5f5;">
                                    <div class="form-text" style="color: var(--color-info); font-size: var(--font-size-xs); margin-top: 4px;">
                                        <i class="fa-solid fa-circle-info"></i> 來源：戶別預約條件設定
                                    </div>
                                </div>
                            </div>
                            <!-- 其他補充 -->
                            <div class="form-group">
                                <label class="form-label">其他補充</label>
                                <textarea class="form-control" id="hOtherSupplement" rows="3" placeholder="請輸入補充說明"></textarea>
                            </div>
                            
                            <!-- 圖片上傳 -->
                            <div class="form-group">
                                <label class="form-label">附件圖片上傳</label>
                                <div class="upload-box" style="border: 2px dashed var(--color-gray-300); padding: 20px; text-align: center; border-radius: 8px;">
                                     <input type="file" id="loanImageUpload" accept="image/*" multiple style="display: none;">
                                     <button type="button" class="btn btn-secondary" onclick="document.getElementById('loanImageUpload').click()">
                                        <i class="fa-solid fa-image"></i> 選擇圖片
                                     </button>
                                     <p style="margin-top: 10px; color: var(--color-gray-500);">支援 jpg, png 格式</p>
                                </div>
                                <div id="loanImagePreview" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;"></div>
                            </div>
                        </div>

                        <!-- 完工資訊區塊 -->
                        <div class="section-block" id="sectionRecordInfo">
                            <h3 class="section-title">紀錄資訊</h3>
                            <div class="form-group">
                                <label class="form-label required" for="cCompletedDate">完成日期</label>
                                <input type="date" class="form-control" id="cCompletedDate" name="cCompletedDate" required="">
                            </div>
                            <div class="form-group">
                                <label class="form-label required" for="cCompletedNotes">紀錄說明</label>
                                <textarea class="form-control" id="cCompletedNotes" name="cCompletedNotes" placeholder="對保紀錄說明" rows="3" required=""></textarea>
                                <div class="quick-fill-buttons">
                                    <span class="quick-fill-label">快速填入：</span>
                                    <button type="button" class="btn btn-sm btn-secondary quick-fill-btn" data-text="已完成所有對保手續">已完成所有對保手續</button>
                                    <button type="button" class="btn btn-sm btn-secondary quick-fill-btn" data-text="資料不齊全，需補件">資料不齊全，需補件</button>
                                </div>
                            </div>
                        </div>

                        <!-- 檔案上傳區塊 -->
                        <div class="section-block">
                            <h3 class="section-title">上傳檔案</h3>
                            <label for="fileUpload" class="upload-wrap">
                                <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
                                <p class="text-info text-center" id="uploadPlaceholder">拖曳檔案至此處或點擊上傳</p>
                                <input type="file" id="fileUpload" name="fileUpload" accept=".jpg,.mp4,.heic,.heif,.pdf" multiple="" class="file-input">
                                <span class="upload-btn"><i class="fa-solid fa-plus"></i> 選擇檔案</span>
                            </label>
                            <p class="upload-hint">*支援圖片 .jpg、影片 .mp4、文件 .pdf，最大 5MB</p>
                            <div class="upload-list" id="uploadList">
                                <!-- 上傳的檔案列表 -->
                            </div>
                        </div>

                        <!-- 簽名區塊 -->
                        <div class="section-block" id="sectionSignature">
                            <div class="signature-header">
                                <h3 class="section-title">住戶簽名確認</h3>
                                <!-- 此次不用簽名核取方塊 -->
                                <label class="skip-signature-label">
                                    <input type="checkbox" id="skipSignature" class="form-checkbox" checked>
                                    <span>維護人員註記：此次無需簽名</span>
                                </label>
                            </div>
                            <div class="signature-block">
                                <div class="signature-area" id="signatureArea">
                                    <canvas id="signatureCanvas" width="1102" height="200" style="width: 100%; height: 200px;"></canvas>
                                    <div class="signature-placeholder" id="signaturePlaceholder">
                                        <i class="fa-solid fa-signature"></i>
                                        <span>點擊此處進行簽名</span>
                                    </div>
                                    <!-- 停用簽名時的遮罩層 -->
                                    <div class="signature-disabled-overlay" id="signatureDisabledOverlay">
                                        <i class="fa-solid fa-ban"></i>
                                        <span>已標記為無需簽名</span>
                                    </div>
                                </div>
                                <div class="signature-buttons">
                                    <button type="button" class="btn btn-secondary" id="btnClearSign">
                                        <i class="fa-solid fa-eraser"></i> 清除簽名
                                    </button>
                                    <button type="button" class="btn btn-primary" id="btnConfirmSign">
                                        <i class="fa-solid fa-check"></i> 確認簽名
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 留言板 -->
                        <div class="section-block" id="sectionChat">
                            <h3 class="section-title">
                                <i class="fa-regular fa-comments"></i> 留言板
                            </h3>

                            <div class="chat-container" id="chatContainer">
                                <!-- 對話訊息區域 -->
                                <div class="chat-messages" id="chatMessages">
                                    <!-- 用戶訊息（右側）- 含圖片 -->
                                    <div class="message message-right">
                                        <div class="message-content">請問要準備什麼證件嗎？</div>
                                        <div class="message-info">陳小明 2025/08/05 10:30 AM</div>
                                    </div>

                                    <!-- 客服回覆（左側） -->
                                    <div class="message message-left">
                                        <div class="message-content">您好，請攜帶雙證件及印鑑</div>
                                        <div class="message-info">王曉明 2025/08/05 10:35 AM</div>
                                    </div>
                                </div>

                                <!-- 輸入框區域 -->
                                <div class="chat-input-area">
                                    <!-- 附件按鈕區域 (15%) -->
                                    <div class="chat-input-left">
                                        <button type="button" class="attach-btn" id="btnAttachFile" title="附加檔案">
                                            <i class="fa-solid fa-paperclip"></i>
                                        </button>
                                        <input type="file" id="chatFileInput" class="hidden-file-input" accept="image/*,video/*,.pdf,.doc,.docx">
                                        <span class="file-limit-hint">
                                            <i class="fa-solid fa-circle-info"></i>
                                            檔案限制：10MB，支援格式：圖片、影片、PDF、Word
                                        </span>
                                    </div>
                                    <!-- 文字輸入區域 (85%) -->
                                    <div class="chat-input-right">
                                        <input type="text" class="chat-input" id="chatInput" placeholder="輸入訊息...">
                                        <button type="button" class="send-btn" id="btnSendMessage" title="發送訊息">
                                            <i class="fa-solid fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 按鈕區 -->
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="history.back()">取消</button>
                            <button type="submit" class="btn btn-primary">儲存</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script src="js/menu-component.js"></script>
    <script src="js/sidebar.js"></script>
    <script src="js/mock-data.js"></script>
    <script src="js/reservation-collateral-edit.js"></script>
</body>
</html>
