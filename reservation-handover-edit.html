<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>編輯交屋預約 - 陸府建設 CRM</title>
    
    <!-- Font Awesome 圖示 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CSS 樣式 -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/breadcrumb.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/forms.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/chat.css">
    <style>
        .edit-container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .section-block {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .section-block:last-child {
            border-bottom: none;
        }
        
        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quick-fill-buttons {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .quick-fill-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .upload-wrap {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
        }
        
        .upload-wrap:hover {
            border-color: #a99e91;
            background: #f9f9f9;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #ccc;
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-btn {
            display: inline-block;
            padding: 8px 20px;
            background: #a99e91;
            color: #fff;
            border-radius: 4px;
            margin-top: 15px;
        }
        
        .upload-hint {
            font-size: 0.85rem;
            color: #999;
            margin-top: 8px;
            text-align: center;
        }
        
        .signature-block {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background: #f9f9f9;
        }
        
        .signature-area {
            background: #fff;
            border: 1px dashed #ccc;
            height: 200px;
            position: relative;
            margin-bottom: 15px;
            cursor: crosshair;
        }
        
        .signature-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ccc;
            text-align: center;
            pointer-events: none;
        }
        
        .signature-placeholder i {
            font-size: 32px;
            display: block;
            margin-bottom: 5px;
        }
        
        .signature-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .form-actions .btn {
            min-width: 120px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 頂部導覽列 -->
        <header class="header">
            <div class="header-left">
                <button class="header-toggle" id="sidebarToggle" title="展開/收合選單">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <div class="header-brand">
                    <span class="header-title">CRM</span>
                </div>
            </div>
            <div class="header-right"></div>
        </header>

        <!-- 側邊欄選單 -->
        <!-- ============================================ -->
        <aside class="sidebar" id="sidebar">
            <div class="main-container main-container-fixed">
                <div class="scrollable">
                    <ul class="menu-items">
                        <!-- 首頁 -->
                        <li class="menu-item" data-menu-id="home">
                            <a href="index.html" title="首頁">
                                <i class="menu-icon fa-solid fa-house"></i>
                                <span class="menu-title">首頁</span>
                            </a>
                        </li>

                        <!-- 系統管理 -->
                        <li class="menu-item" data-menu-id="system">
                            <a href="javascript:void(0)" title="系統管理">
                                <i class="menu-icon fa-solid fa-gear"></i>
                                <span class="menu-title">系統管理</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="system-user.html" title="使用者管理"><span class="menu-title">使用者管理</span></a></li>
                                <li class="menu-item"><a href="system-role.html" title="角色權限管理"><span class="menu-title">角色權限管理</span></a></li>
                                <li class="menu-item"><a href="system-log.html" title="操作紀錄查詢"><span class="menu-title">操作紀錄查詢</span></a></li>
                                <li class="menu-item"><a href="#" title="APP使用者管理 (未完成)"><span class="menu-title">APP使用者管理 (未完成)</span></a></li>
                            </ul>
                        </li>

                        <!-- CRM設定 -->
                        <li class="menu-item" data-menu-id="crm">
                            <a href="javascript:void(0)" title="CRM設定">
                                <i class="menu-icon fa-solid fa-sliders"></i>
                                <span class="menu-title">CRM設定</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="crm-vendor.html" title="廠商管理"><span class="menu-title">廠商管理</span></a></li>
                                <li class="menu-item"><a href="crm-project.html" title="案場管理"><span class="menu-title">案場管理</span></a></li>
                                <li class="menu-item"><a href="crm-milestone.html" title="里程碑管理"><span class="menu-title">里程碑管理</span></a></li>
                                <li class="menu-item"><a href="crm-warranty.html" title="案場保固設定"><span class="menu-title">案場保固設定</span></a></li>
                                <li class="menu-item"><a href="#" title="LINE頁面管理 (未完成)"><span class="menu-title">LINE頁面管理 (未完成)</span></a></li>
                                <li class="menu-item"><a href="crm-email.html" title="郵件管理"><span class="menu-title">郵件管理</span></a></li>
                                <li class="menu-item"><a href="#" title="驗屋項目管理 (未完成)"><span class="menu-title">驗屋項目管理 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="巡檢項目管理 (未完成)"><span class="menu-title">巡檢項目管理 (未完成)</span></a></li>
                            </ul>
                        </li>

                        <!-- 戶別管理 -->
                        <li class="menu-item" data-menu-id="unit">
                            <a href="javascript:void(0)" title="戶別管理">
                                <i class="menu-icon fa-solid fa-building"></i>
                                <span class="menu-title">戶別管理</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="unit-list.html" title="戶別管理"><span class="menu-title">戶別管理</span></a></li>
                                <li class="menu-item"><a href="#" title="驗屋戶別管理 (未完成)"><span class="menu-title">驗屋戶別管理 (未完成)</span></a></li>
                                <li class="menu-item"><a href="unit-payment.html" title="繳款紀錄"><span class="menu-title">繳款紀錄</span></a></li>
                                <li class="menu-item"><a href="#" title="合約附件 (未完成)"><span class="menu-title">合約附件 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="戶別預約設定 (未完成)"><span class="menu-title">戶別預約設定 (未完成)</span></a></li>
                            </ul>
                        </li>

                        <!-- 會員管理 -->
                        <li class="menu-item" data-menu-id="member">
                            <a href="javascript:void(0)" title="會員管理">
                                <i class="menu-icon fa-solid fa-users"></i>
                                <span class="menu-title">會員管理</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="member-list.html" title="會員管理"><span class="menu-title">會員管理</span></a></li>
                                <li class="menu-item"><a href="member-bindline.html" title="Line 綁定"><span class="menu-title">Line 綁定</span></a></li>
                                <li class="menu-item"><a href="#" title="活動歷程 (未完成)"><span class="menu-title">活動歷程 (未完成)</span></a></li>
                            </ul>
                        </li>

                        <!-- 個案單管理 -->
                        <li class="menu-item" data-menu-id="case">
                            <a href="javascript:void(0)" title="個案單管理">
                                <i class="menu-icon fa-solid fa-file-invoice"></i>
                                <span class="menu-title">個案單管理</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="case-list.html" title="個案單"><span class="menu-title">個案單</span></a></li>
                                <li class="menu-item"><a href="green-case-list.html" title="綠海報修個案單"><span class="menu-title">綠海報修個案單</span></a></li>
                                <li class="menu-item"><a href="#" title="驗屋修繕紀錄 (未完成)"><span class="menu-title">驗屋修繕紀錄 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="巡檢紀錄 (未完成)"><span class="menu-title">巡檢紀錄 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="驗屋個案單 (未完成)"><span class="menu-title">驗屋個案單 (未完成)</span></a></li>
                            </ul>
                        </li>

                        <!-- 派工單管理 -->
                        <li class="menu-item" data-menu-id="dispatch">
                            <a href="javascript:void(0)" title="派工單管理">
                                <i class="menu-icon fa-solid fa-clipboard-list"></i>
                                <span class="menu-title">派工單管理</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="work-order.html" title="派工單管理"><span class="menu-title">派工單管理</span></a></li>
                            </ul>
                        </li>

                        <!-- 綠海養護 -->
                        <li class="menu-item" data-menu-id="green">
                            <a href="javascript:void(0)" title="綠海養護">
                                <i class="menu-icon fa-solid fa-leaf"></i>
                                <span class="menu-title">綠海養護</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="green-site.html" title="案場管理(綠海)"><span class="menu-title">案場管理(綠海)</span></a></li>
                                <li class="menu-item"><a href="green-contract.html" title="養護合約"><span class="menu-title">養護合約</span></a></li>
                                <li class="menu-item"><a href="green-reservation.html" title="服務紀錄"><span class="menu-title">服務紀錄</span></a></li>
                            </ul>
                        </li>

                        <!-- 預約服務 -->
                        <li class="menu-item" data-menu-id="reservation">
                            <a href="javascript:void(0)" title="預約服務">
                                <i class="menu-icon fa-solid fa-calendar-check"></i>
                                <span class="menu-title">預約服務</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="reservation-collateral.html" title="對保預約"><span class="menu-title">對保預約</span></a></li>
                                <li class="menu-item"><a href="reservation-inspection.html" title="驗屋預約"><span class="menu-title">驗屋預約</span></a></li>
                                <li class="menu-item"><a href="reservation-handover.html" title="交屋預約"><span class="menu-title">交屋預約</span></a></li>
                                <li class="menu-item"><a href="reservation-custom.html" title="客變預約"><span class="menu-title">客變預約</span></a></li>
                            </ul>
                        </li>

                        <!-- 房屋健檢 -->
                        <li class="menu-item" data-menu-id="checkup">
                            <a href="javascript:void(0)" title="房屋健檢">
                                <i class="menu-icon fa-solid fa-stethoscope"></i>
                                <span class="menu-title">房屋健檢</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="house-checkup-schedule.html" title="健檢排程"><span class="menu-title">健檢排程</span></a></li>
                                <li class="menu-item"><a href="house-checkup-items.html" title="檢查項目"><span class="menu-title">檢查項目</span></a></li>
                            </ul>
                        </li>

                        <!-- 活動管理 -->
                        <li class="menu-item" data-menu-id="activity">
                            <a href="javascript:void(0)" title="活動管理">
                                <i class="menu-icon fa-solid fa-calendar-days"></i>
                                <span class="menu-title">活動管理</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="activity-list.html" title="活動清單"><span class="menu-title">活動清單</span></a></li>
                                <li class="menu-item"><a href="activity-registration.html" title="報名管理"><span class="menu-title">報名管理</span></a></li>
                            </ul>
                        </li>

                        <!-- 報表管理 -->
                        <li class="menu-item" data-menu-id="report">
                            <a href="javascript:void(0)" title="報表管理">
                                <i class="menu-icon fa-solid fa-chart-pie"></i>
                                <span class="menu-title">報表管理</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="#" title="售後服務管制總表 (未完成)"><span class="menu-title">售後服務管制總表 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="未結案個案單 (未完成)"><span class="menu-title">未結案個案單 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="全部建案維修類統計表 (未完成)"><span class="menu-title">全部建案維修類統計表 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="全部建案維修部品統計表 (未完成)"><span class="menu-title">全部建案維修部品統計表 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="全部建案維修位置統計表 (未完成)"><span class="menu-title">全部建案維修位置統計表 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="滿意度調查統計 (未完成)"><span class="menu-title">滿意度調查統計 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="客戶滿意度明細表 (未完成)"><span class="menu-title">客戶滿意度明細表 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="全部建案維修狀態統計表 (未完成)"><span class="menu-title">全部建案維修狀態統計表 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="案件數量統計表 (未完成)"><span class="menu-title">案件數量統計表 (未完成)</span></a></li>
                                <li class="menu-item"><a href="#" title="任務完成統計表 (未完成)"><span class="menu-title">任務完成統計表 (未完成)</span></a></li>
                            </ul>
                        </li>

                        <!-- 推播管理 -->
                        <li class="menu-item" data-menu-id="push">
                            <a href="javascript:void(0)" title="推播管理">
                                <i class="menu-icon fa-solid fa-bell"></i>
                                <span class="menu-title">推播管理</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="#" title="推播管理 (未完成)"><span class="menu-title">推播管理 (未完成)</span></a></li>
                            </ul>
                        </li>

                        <!-- 問卷管理 -->
                        <li class="menu-item" data-menu-id="questionnaire">
                            <a href="javascript:void(0)" title="問卷管理">
                                <i class="menu-icon fa-solid fa-clipboard-question"></i>
                                <span class="menu-title">問卷管理</span>
                                <i class="expand-state fa-solid fa-chevron-right"></i>
                            </a>
                            <ul class="menu-items">
                                <li class="menu-item"><a href="#" title="題目管理 (未完成)"><span class="menu-title">題目管理 (未完成)</span></a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </aside>

        <!-- ============================================ -->
        <!-- 主內容區域 -->
        <main class="main-content">
            <div class="breadcrumb">
                <a href="index.html" class="breadcrumb-item">
                    <i class="fa-solid fa-house"></i>
                    首頁
                </a>
                <span class="breadcrumb-separator">/</span>
                <a href="reservation-handover.html" class="breadcrumb-item">交屋預約</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-item active">編輯預約</span>
            </div>

            <div class="content-wrapper">
                <div class="page-header">
                    <h1 class="page-title">編輯交屋預約</h1>
                </div>

                <div class="edit-container">
                    <form id="handoverEditForm">
                        <input type="hidden" id="handoverId">
                        
                        <!-- 基本資料區塊 -->
                        <div class="section-block">
                            <h3 class="section-title">基本資料</h3>
                            <div class="form-row">
                                <!-- 案場 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">案場</label>
                                    <select class="form-select" id="hProject" required>
                                        <option value="">請選擇案場</option>
                                        <option value="陸府原森">陸府原森</option>
                                        <option value="陸府觀微">陸府觀微</option>
                                        <option value="陸府植森">陸府植森</option>
                                    </select>
                                </div>
                                <!-- 戶別 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">戶別</label>
                                    <select class="form-select" id="hUnit" required disabled>
                                        <option value="">請先選擇案場</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <!-- 預約者姓名 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">預約者姓名</label>
                                    <input type="text" class="form-control" id="hMemberName" required placeholder="請輸入預約者姓名">
                                </div>
                                <!-- 手機 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">手機</label>
                                    <input type="tel" class="form-control" id="hPhone" required placeholder="請輸入手機號碼" pattern="09[0-9]{8}" title="請輸入有效的手機號碼，格式：09xxxxxxxx">
                                </div>
                            </div>
                            <div class="form-row">
                                <!-- 日期 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">日期</label>
                                    <input type="date" class="form-control" id="hDate" required>
                                </div>
                                <!-- 時段 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">時段</label>
                                    <select class="form-select" id="hTimeSlot" required>
                                        <option value="">請選擇時段</option>
                                        <option value="09:00-10:00">09:00-10:00</option>
                                        <option value="10:00-11:00">10:00-11:00</option>
                                        <option value="11:00-12:00">11:00-12:00</option>
                                        <option value="14:00-15:00">14:00-15:00</option>
                                        <option value="15:00-16:00">15:00-16:00</option>
                                        <option value="16:00-17:00">16:00-17:00</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <!-- 主責人員 -->
                                <div class="form-group col-md-6">
                                    <label class="form-label required">主責人員</label>
                                    <select class="form-select" id="hInCharge" required>
                                        <option value="">請選擇主責人員</option>
                                        <option value="王大明">王大明</option>
                                        <option value="李小華">李小華</option>
                                        <option value="張志豪">張志豪</option>
                                        <option value="陳淑芬">陳淑芬</option>
                                    </select>
                                </div>
                            </div>
                            <!-- 備註 -->
                            <div class="form-group">
                                <label class="form-label">備註</label>
                                <textarea class="form-control" id="hRemark" rows="3" placeholder="請輸入備註（選填）"></textarea>
                            </div>
                        </div>

                        <!-- 完工資訊區塊 -->
                        <div class="section-block">
                            <h3 class="section-title">紀錄資訊</h3>
                            <div class="form-group">
                                <label class="form-label required" for="cCompletedDate">完成日期</label>
                                <input type="date" class="form-control" id="cCompletedDate" name="cCompletedDate" required="">
                            </div>
                            <div class="form-group">
                                <label class="form-label required" for="cCompletedNotes">紀錄說明</label>
                                <textarea class="form-control" id="cCompletedNotes" name="cCompletedNotes" placeholder="完工說明" rows="3" required=""></textarea>
                                <div class="quick-fill-buttons">
                                    <span class="quick-fill-label">快速填入：</span>
                                    <button type="button" class="btn btn-sm btn-secondary quick-fill-btn" data-text="已完成所有交屋事項">已完成所有交屋事項</button>
                                    <!-- <button type="button" class="btn btn-sm btn-secondary quick-fill-btn" data-text="已說明">以說明</button> -->
                                    <!-- <button type="button" class="btn btn-sm btn-secondary quick-fill-btn" data-text="已完成所有修繕工作，保固三個月">已完成所有修繕工作，保固三個月</button> -->
                                </div>
                            </div>
                        </div>

                        <!-- 檔案上傳區塊 -->
                        <div class="section-block">
                            <h3 class="section-title">上傳檔案</h3>
                            <label for="fileUpload" class="upload-wrap">
                                <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
                                <p class="text-info text-center" id="uploadPlaceholder">拖曳檔案至此處或點擊上傳</p>
                                <input type="file" id="fileUpload" name="fileUpload" accept=".jpg,.mp4,.heic,.heif" multiple="" class="file-input">
                                <span class="upload-btn"><i class="fa-solid fa-plus"></i> 選擇檔案</span>
                            </label>
                            <p class="upload-hint">*支援圖片 .jpg、影片 .mp4，最大 5MB</p>
                            <div class="upload-list" id="uploadList">
                                <!-- 上傳的檔案列表 -->
                            </div>
                        </div>

                        <!-- 簽名區塊 -->
                        <div class="section-block">
                            <h3 class="section-title">住戶簽名確認</h3>
                            <div class="signature-block">
                                <div class="signature-area" id="signatureArea">
                                    <canvas id="signatureCanvas" width="1102" height="200" style="width: 100%; height: 200px;"></canvas>
                                    <div class="signature-placeholder" id="signaturePlaceholder">
                                        <i class="fa-solid fa-signature"></i>
                                        <span>點擊此處進行簽名</span>
                                    </div>
                                </div>
                                <div class="signature-buttons">
                                    <button type="button" class="btn btn-secondary" id="btnClearSign">
                                        <i class="fa-solid fa-eraser"></i> 清除簽名
                                    </button>
                                    <button type="button" class="btn btn-primary" id="btnConfirmSign">
                                        <i class="fa-solid fa-check"></i> 確認簽名
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 其他設定 -->
                        <div class="form-group">
                            <label class="form-label" for="cIsNotSendQuestionnaire">是否本次不寄發滿意度問卷</label>
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="cIsNotSendQuestionnaire" name="cIsNotSendQuestionnaire" class="form-checkbox">
                                <label for="cIsNotSendQuestionnaire" class="checkbox-label">不寄發</label>
                            </div>
                        </div>

                        <!-- 留言板 -->
                        <div class="section-block">
                            <h3 class="section-title">
                                <i class="fa-regular fa-comments"></i> 留言板
                            </h3>

                            <div class="chat-container" id="chatContainer">
                                <!-- 對話訊息區域 -->
                                <div class="chat-messages" id="chatMessages">
                                    <!-- 用戶訊息（右側）- 含圖片 -->
                                    <div class="message message-right">
                                        <div class="message-content">請問要攜帶甚麼東西嗎？</div>
                                        <div class="message-info">陳小明 2025/08/05 10:30 AM</div>
                                    </div>

                                    <!-- 用戶訊息（右側）- 含圖片附件 -->
                                    <div class="message message-right">
                                        <div class="message-media">
                                            <img src="https://via.placeholder.com/300x200/e0e0e0/666?text=漏水照片" alt="客戶上傳圖片" class="media-image" data-full-src="https://via.placeholder.com/800x600/e0e0e0/666?text=漏水照片">
                                        </div>
                                        <div class="message-info">陳小明 2025/08/05 10:31 AM</div>
                                    </div>

                                    <!-- 客服回覆（左側） -->
                                    <div class="message message-left">
                                        <div class="message-content">您好，請準備存摺影本、身分證資訊</div>
                                        <div class="message-file">
                                            <i class="fa-solid fa-file-pdf file-icon"></i>
                                            <span class="file-name">交屋說明文件.pdf</span>
                                            <button class="file-download" title="下載檔案">
                                                <i class="fa-solid fa-download"></i>
                                            </button>
                                        </div>
                                        <div class="message-info">王曉明 2025/08/05 10:30 AM</div>
                                    </div>

                                    <!-- 用戶訊息（右側）- 含影片 -->
                                    <div class="message message-right">
                                        <div class="message-content">這是我準備的清單影片</div>
                                        <div class="message-media">
                                            <video controls="" class="media-video" preload="metadata">
                                                <source src="" type="video/mp4">
                                                您的瀏覽器不支援影片播放
                                            </video>
                                            <div class="video-placeholder">
                                                <i class="fa-solid fa-play-circle"></i>
                                                <span>20250805001.mp4</span>
                                            </div>
                                        </div>
                                        <div class="message-info">陳小明 2025/08/05 10:32 AM</div>
                                    </div>

                                    <!-- 客服回覆（左側） -->
                                    <div class="message message-left">
                                        <div class="message-content">存摺看起來有點破損，建議先至銀行作確認哦</div>
                                        <div class="message-info">王曉明 2025/08/05 15:30 AM</div>
                                    </div>
                                </div>

                                <!-- 輸入框區域 -->
                                <div class="chat-input-area">
                                    <!-- 附件按鈕區域 (15%) -->
                                    <div class="chat-input-left">
                                        <button type="button" class="attach-btn" id="btnAttachFile" title="附加檔案">
                                            <i class="fa-solid fa-paperclip"></i>
                                        </button>
                                        <input type="file" id="chatFileInput" class="hidden-file-input" accept="image/*,video/*,.pdf,.doc,.docx">
                                        <span class="file-limit-hint">
                                            <i class="fa-solid fa-circle-info"></i>
                                            檔案限制：10MB，支援格式：圖片、影片、PDF、Word
                                        </span>
                                    </div>
                                    <!-- 文字輸入區域 (85%) -->
                                    <div class="chat-input-right">
                                        <input type="text" class="chat-input" id="chatInput" placeholder="輸入訊息...">
                                        <button type="button" class="send-btn" id="btnSendMessage" title="發送訊息">
                                            <i class="fa-solid fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 按鈕區 -->
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="history.back()">取消</button>
                            <button type="submit" class="btn btn-primary">儲存</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script src="js/sidebar.js"></script>
    <script src="js/mock-data.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarManager = new SidebarManager();
            
            // 取得 URL 參數中的 ID
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            
            // 案場與戶別連動資料
            const projectUnits = {
                '陸府原森': ['A棟10F', 'A棟11A', 'A棟12A', 'A棟12B', 'B棟5A', 'B棟8A', 'C棟3A'],
                '陸府觀微': ['A1-2F', 'A1-3F', 'A2-5F', 'A2-6F', 'B1-3F', 'B1-4F'],
                '陸府植森': ['1棟-2F', '1棟-3F', '2棟-5F', '2棟-6F', '3棟-2F', '3棟-3F']
            };
            
            // 案場選擇變更事件
            document.getElementById('hProject').addEventListener('change', function() {
                const projectName = this.value;
                const unitSelect = document.getElementById('hUnit');
                
                // 清空戶別選項
                unitSelect.innerHTML = '';
                
                if (projectName && projectUnits[projectName]) {
                    unitSelect.disabled = false;
                    unitSelect.innerHTML = '<option value="">請選擇戶別</option>';
                    projectUnits[projectName].forEach(function(unit) {
                        const option = document.createElement('option');
                        option.value = unit;
                        option.textContent = unit;
                        unitSelect.appendChild(option);
                    });
                } else {
                    unitSelect.disabled = true;
                    unitSelect.innerHTML = '<option value="">請先選擇案場</option>';
                }
            });
            
            // 載入資料
            if (id) {
                const handover = CRMMockData.getById('handoverReservations', parseInt(id));
                if (handover) {
                    document.getElementById('handoverId').value = handover.id;
                    
                    // 設定案場並觸發戶別載入
                    const projectSelect = document.getElementById('hProject');
                    projectSelect.value = handover.projectName;
                    
                    // 手動觸發案場變更以載入戶別選項
                    const unitSelect = document.getElementById('hUnit');
                    unitSelect.innerHTML = '';
                    if (handover.projectName && projectUnits[handover.projectName]) {
                        unitSelect.disabled = false;
                        unitSelect.innerHTML = '<option value="">請選擇戶別</option>';
                        projectUnits[handover.projectName].forEach(function(unit) {
                            const option = document.createElement('option');
                            option.value = unit;
                            option.textContent = unit;
                            unitSelect.appendChild(option);
                        });
                    }
                    
                    document.getElementById('hUnit').value = handover.unitName;
                    document.getElementById('hMemberName').value = handover.memberName;
                    document.getElementById('hPhone').value = handover.phone || '';
                    document.getElementById('hDate').value = handover.reservationDate || '';
                    document.getElementById('hTimeSlot').value = handover.timeSlot || '';
                    document.getElementById('hInCharge').value = handover.inCharge || '';
                    document.getElementById('hRemark').value = handover.remark || '';
                }
            }
            
            // 快速填入按鈕
            document.querySelectorAll('.quick-fill-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.getElementById('cCompletedNotes').value = this.dataset.text;
                });
            });
            
            // 簽名板功能
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            // 調整 Canvas 大小
            function resizeCanvas() {
                const parent = canvas.parentElement;
                canvas.width = parent.clientWidth;
                canvas.height = parent.clientHeight;
            }
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            
            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
                document.getElementById('signaturePlaceholder').style.display = 'none';
            }
            
            function draw(e) {
                if (!isDrawing) return;
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();
                [lastX, lastY] = [e.offsetX, e.offsetY];
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            document.getElementById('btnClearSign').addEventListener('click', function() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                document.getElementById('signaturePlaceholder').style.display = 'block';
            });
            
            // 表單提交
            document.getElementById('handoverEditForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 更新資料
                const id = parseInt(document.getElementById('handoverId').value);
                const handover = CRMMockData.getById('handoverReservations', id);
                if (handover) {
                    handover.projectName = document.getElementById('hProject').value;
                    handover.unitName = document.getElementById('hUnit').value;
                    handover.memberName = document.getElementById('hMemberName').value;
                    handover.phone = document.getElementById('hPhone').value;
                    handover.reservationDate = document.getElementById('hDate').value;
                    handover.timeSlot = document.getElementById('hTimeSlot').value;
                    handover.inCharge = document.getElementById('hInCharge').value;
                    handover.remark = document.getElementById('hRemark').value;
                    
                    CRMMockData.save();
                }

                alert('資料已儲存');
                window.location.href = 'reservation-handover.html';
            });
        });
    </script>
</body>
</html>